SELECT
  CAST(
    GET_PATH (config.CLOUD_DETAILS, 'accountID') AS TEXT
  ) AS AWS_ACCOUNT_ID,
  CAST(
    GET_PATH (config.CLOUD_DETAILS, 'accountAlias') AS TEXT
  ) AS AWS_ACCOUNT_ALIAS,
  COUNT(
    DISTINCT CAST(
      GET_PATH (config.RESOURCE_CONFIG, 'DomainName') AS TEXT
    )
  ) AS TOTAL_CLOUDFRONT_DISTRIBUTIONS,
  
FROM
  CLOUD_CONFIGURATION_V AS config
WHERE
  config.CSP ILIKE '%aws%'
  AND config.RESOURCE_TYPE ILIKE '%cloudfront%'
  AND config.START_TIME > DATEADD (HOUR, -24, CURRENT_DATE)
GROUP BY
  AWS_ACCOUNT_ID,
  AWS_ACCOUNT_ALIAS
ORDER BY
  AWS_ACCOUNT_ID;
